<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FedEx Attendance Login</title>
<style>
  /* --- Full page & background --- */
  body {
    font-family: "Segoe UI", Arial, sans-serif;
    background: linear-gradient(135deg, #4D148C, #7A2FBF, #FF6600);
    background-size: 300% 300%;
    animation: gradientShift 12s ease infinite;
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  @keyframes gradientShift {
    0% { background-position:0% 50%; }
    50% { background-position:100% 50%; }
    100% { background-position:0% 50%; }
  }

  /* --- Container --- */
  .container {
    width: 100%;
    max-width: 400px;
    background: rgba(255,255,255,0.95);
    padding: 50px 35px 40px 35px;
    border-radius: 18px;
    box-shadow: 0 8px 35px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
    animation: cardFade 0.9s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  @keyframes cardFade {
    from { opacity:0; transform:scale(0.95) translateY(10px); }
    to { opacity:1; transform:scale(1) translateY(0); }
  }

  /* --- Logo --- */
  .logo img {
    width: 160px;
    margin-bottom: 20px;
  }

  h2 {
    margin: 0 0 30px 0;
    font-size: 22px;
    color: #4D148C;
    text-align: center;
  }

  /* --- Inputs --- */
  .input-group { position: relative; width: 100%; margin-bottom: 18px; }
  input {
    width: 100%;
    padding: 12px 45px 12px 14px;
    border-radius: 8px;
    border: 1px solid #bbb;
    font-size: 15px;
    transition: 0.25s;
    box-sizing: border-box;
  }
  input:focus {
    border-color: #4D148C;
    box-shadow: 0 0 8px rgba(77,20,140,0.3);
    outline: none;
  }

  .show-pass {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    font-size: 14px;
    color: #555;
    user-select: none;
  }

  /* --- Login button --- */
  button {
    width: 100%;
    padding: 13px;
    margin-top: 10px;
    border: none;
    border-radius: 10px;
    font-size: 17px;
    font-weight: bold;
    background: linear-gradient(135deg, #4D148C, #7A2FBF);
    color: white;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }
  button:hover { background: linear-gradient(135deg,#FF6600,#FF8C42); }
  button:active::after {
    content:"";
    position:absolute;
    left:50%; top:50%;
    width:120%; height:120%;
    background: rgba(255,255,255,0.25);
    border-radius: 50%;
    transform: translate(-50%,-50%) scale(0);
    animation: ripple 0.6s linear;
  }

  @keyframes ripple {
    to { transform: translate(-50%,-50%) scale(2); opacity: 0; }
  }

  /* Spinner */
  .spinner {
    border: 3px solid #f3f3f3;
    border-top: 3px solid #4D148C;
    border-radius: 50%;
    width: 22px; height: 22px;
    animation: spin 1s linear infinite;
    display:inline-block;
    vertical-align: middle;
    margin-left: 10px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Shake animation */
  .shake { animation: shake 0.4s; }
  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20%,60% { transform: translateX(-8px); }
    40%,80% { transform: translateX(8px); }
  }

  /* Footer */
  .footer {
    text-align: center;
    font-size: 12px;
    margin-top: 20px;
    color: #666;
  }

  /* Mobile */
  @media(max-width: 480px) {
    .container { padding: 40px 20px 35px 20px; }
    input { padding: 12px 40px 12px 12px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="logo">
    <img src="4373166_fedex_logo_logos_icon.png" alt="FedEx Logo">
  </div>
  <h2>Tracker Login</h2>

  <div class="input-group">
    <input type="text" id="domainId" placeholder="Domain ID">
  </div>

  <div class="input-group">
    <input type="password" id="password" placeholder="Password">
    <span class="show-pass" onclick="togglePassword()">Show</span>
  </div>

  <button id="loginBtn" onclick="login()">Login</button>

  <div class="input-group" style="margin-top:15px;text-align:center;">
    <a href="#" onclick="resetPassword()" style="color:#4D148C;text-decoration:none;font-size:14px;">Forgot Password?</a>
  </div>

  <div class="footer">© 2025 FedEx Attendance System</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAFedbBDXSZomKX8MQkBfVBRfi6tl0LTcc",
  authDomain: "fedex-attendance-system.firebaseapp.com",
  projectId: "fedex-attendance-system",
  storageBucket: "fedex-attendance-system.appspot.com",
  messagingSenderId: "1049424874301",
  appId: "1:1049424874301:web:f94559159b19ee39c19354"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Show/hide password
window.togglePassword = () => {
  const input = document.getElementById("password");
  const span = document.querySelector(".show-pass");
  input.type = input.type === "password" ? "text" : "password";
  span.textContent = input.type==="password"?"Show":"Hide";
};

// Login
window.login = async () => {
  const btn = document.getElementById("loginBtn");
  const domainId = document.getElementById("domainId");
  const password = document.getElementById("password");

  if(!domainId.value || !password.value){
    domainId.classList.add("shake");
    password.classList.add("shake");
    setTimeout(()=>{ domainId.classList.remove("shake"); password.classList.remove("shake"); },400);
    return;
  }

  btn.disabled=true;
  const spinner = document.createElement("span"); spinner.className="spinner"; btn.appendChild(spinner);

  try {
    const userRef = doc(db,"users",domainId.value);
    const userDoc = await getDoc(userRef);
    if(!userDoc.exists()) { alert("User not found"); return; }
    const user = userDoc.data();

    // Use stored password from Firestore
    const correctPassword = user.password || "";
    if(password.value !== correctPassword){ alert("Incorrect password"); return; }

    localStorage.setItem("currentUser", JSON.stringify({ id:domainId.value, name:user.name, role:user.role }));
    window.location.href = user.role==="admin" ? "admin-dashboard.html":"employee-dashboard.html";
  } finally {
    btn.disabled=false;
    if(btn.querySelector(".spinner")) btn.querySelector(".spinner").remove();
  }
};

// Reset Password
window.resetPassword = async () => {
  const domainId = prompt("Enter your Domain ID to reset password:");
  if(!domainId) return;
  const userRef = doc(db,"users",domainId);
  const userDoc = await getDoc(userRef);
  if(!userDoc.exists()){ alert("User not found"); return; }

  const newPassword = prompt("Enter your new password:");
  if(!newPassword){ alert("Password not updated."); return; }

  await updateDoc(userRef, { password: newPassword });
  alert("✅ Password successfully updated. You can now login with the new password.");
};
</script>
</body>
</html>
